<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default-layout}">
<head>
    <title th:text="${isEdit} ? 'ê²Œì‹œê¸€ ìˆ˜ì •' : 'ê²Œì‹œê¸€ ì‘ì„±'">ê²Œì‹œê¸€ ì‘ì„±</title>
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/sub-page.css}">
        <link rel="stylesheet" th:href="@{/css/sidebar.css}">
        <link rel="stylesheet" th:href="@{/css/form.css}">
    </th:block>
</head>
<body>
<main layout:fragment="content">
    <!-- í˜ì´ì§€ ë°°ë„ˆ -->
    <th:block th:replace="~{fragments/page-banner :: page-banner('ê³ ê°ì§€ì›', 'ììœ ê²Œì‹œíŒ')}"></th:block>

    <!-- ë¸Œë ˆë“œí¬ëŸ¼ -->
    <th:block th:replace="~{fragments/breadcrumb :: breadcrumb(${breadcrumbItems})}"></th:block>

    <!-- ì„œë¸Œ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ -->
    <div class="sub-page-layout">
        <!-- ì‚¬ì´ë“œë°” -->
        <th:block th:replace="~{layout/sidebar :: sidebar(${menuTitle}, ${menuItems}, ${currentMenu})}"></th:block>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="sub-page-main">
            <h2 class="content-title" th:text="${isEdit} ? 'ê²Œì‹œê¸€ ìˆ˜ì •' : 'ê²Œì‹œê¸€ ì‘ì„±'">ê²Œì‹œê¸€ ì‘ì„±</h2>

            <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

            <!-- ì‘ì„± í¼ -->
            <form th:action="${isEdit} ? @{/support/board/{id}/edit(id=${board.id})} : @{/support/board/write}" 
                  method="post" 
                  enctype="multipart/form-data"
                  class="board-form">
                
                <div class="form-group">
                    <label for="title" class="form-label required">ì œëª©</label>
                    <input type="text" 
                           id="title" 
                           name="title" 
                           class="form-control" 
                           th:classappend="${#fields.hasErrors('title')} ? 'is-invalid' : ''"
                           th:value="${boardRequest.title}"
                           placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                           maxlength="200"
                           required>
                    <div th:if="${#fields.hasErrors('title')}" class="invalid-feedback" th:errors="*{title}">
                        ì œëª© ì˜¤ë¥˜ ë©”ì‹œì§€
                    </div>
                </div>

                <div class="form-group">
                    <label for="content" class="form-label required">ë‚´ìš©</label>
                    <textarea id="content" 
                              name="content" 
                              class="form-control" 
                              th:classappend="${#fields.hasErrors('content')} ? 'is-invalid' : ''"
                              th:text="${boardRequest.content}"
                              placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                              rows="15"
                              required></textarea>
                    <div th:if="${#fields.hasErrors('content')}" class="invalid-feedback" th:errors="*{content}">
                        ë‚´ìš© ì˜¤ë¥˜ ë©”ì‹œì§€
                    </div>
                </div>

                <!-- ê¸°ì¡´ ì²¨ë¶€íŒŒì¼ í‘œì‹œ (ìˆ˜ì • ì‹œ) -->
                <div class="form-group" th:if="${isEdit and board.hasAttachment()}">
                    <label class="form-label">í˜„ì¬ ì²¨ë¶€íŒŒì¼</label>
                    <div class="current-file">
                        <span class="file-info">
                            ğŸ“ <span th:text="${board.attachmentName}">íŒŒì¼ëª….pdf</span>
                            (<span th:text="${board.formattedFileSize}">1.2 MB</span>)
                        </span>
                        <label class="delete-file-label">
                            <input type="checkbox" name="deleteAttachment" value="true">
                            <span>íŒŒì¼ ì‚­ì œ</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="file" class="form-label">ì²¨ë¶€íŒŒì¼</label>
                    <div class="file-upload">
                        <input type="file" 
                               id="file" 
                               name="file"
                               accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.hwp">
                        <label for="file" class="file-upload-label">
                            <span>ğŸ“ íŒŒì¼ ì„ íƒ</span>
                            <span class="file-name">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
                        </label>
                    </div>
                    <p class="form-text text-muted">
                        * ì²¨ë¶€ ê°€ëŠ¥ íŒŒì¼: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, ZIP, HWP (ìµœëŒ€ 10MB)
                    </p>
                </div>

                <div class="form-actions">
                    <a th:href="${isEdit} ? @{/support/board/{id}(id=${board.id})} : @{/support/board}" 
                       class="btn btn-secondary">ì·¨ì†Œ</a>
                    <button type="submit" class="btn btn-primary" th:text="${isEdit} ? 'ìˆ˜ì •' : 'ë“±ë¡'">ë“±ë¡</button>
                </div>
            </form>
        </div>
    </div>
</main>

<th:block layout:fragment="script">
<script>
document.addEventListener('DOMContentLoaded', function() {
    // íŒŒì¼ ì„ íƒ ì‹œ íŒŒì¼ëª… í‘œì‹œ
    const fileInput = document.getElementById('file');
    const fileNameSpan = document.querySelector('.file-name');
    
    if (fileInput && fileNameSpan) {
        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                const maxSize = 10 * 1024 * 1024; // 10MB
                
                if (file.size > maxSize) {
                    alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ë§Œ ì²¨ë¶€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    this.value = '';
                    fileNameSpan.textContent = 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
                    return;
                }
                
                fileNameSpan.textContent = file.name;
            } else {
                fileNameSpan.textContent = 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
            }
        });
    }
    
    // í¼ ì œì¶œ ì „ í™•ì¸
    const form = document.querySelector('.board-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const title = document.getElementById('title').value.trim();
            const content = document.getElementById('content').value.trim();
            
            if (!title) {
                e.preventDefault();
                alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('title').focus();
                return;
            }
            
            if (!content) {
                e.preventDefault();
                alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('content').focus();
                return;
            }
        });
    }
});
</script>
<style>
/* ì¶”ê°€ ìŠ¤íƒ€ì¼ */
.board-form {
    background-color: #fff;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 32px;
}

.board-form .form-group {
    margin-bottom: 24px;
}

.board-form textarea {
    min-height: 300px;
    resize: vertical;
}

.current-file {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 4px;
}

.current-file .file-info {
    color: #495057;
}

.delete-file-label {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    color: #dc3545;
    font-size: 0.875rem;
}

.delete-file-label input {
    cursor: pointer;
}

.form-text {
    margin-top: 8px;
    font-size: 0.8125rem;
}
</style>
</th:block>
</body>
</html>
